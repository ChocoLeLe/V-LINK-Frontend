import{Q as P}from"./QSpinnerDots-8pXkuwk1.js";import{r as _,t as R,M as f,N as r,O as s,P as T,W as o,V as d,S as t,a7 as m,a8 as n,a1 as v,_ as i,X as w,a5 as S,T as C,a0 as c,$ as j,a2 as A,v as M,a4 as F,Z as H,as as V,a3 as O}from"./index-D6DKEz1o.js";import{Q as W}from"./QSpace-BzUJ18PN.js";import{u as X,a as D,b as x,Q}from"./use-quasar-B_lJ7yIQ.js";import{Q as k}from"./QTooltip-C_xb_D0P.js";import{Q as Z}from"./QBadge-DZhUzhq6.js";import{Q as G}from"./QList-CxgAoMwB.js";import{Q as J}from"./QLinearProgress-CZDnHmDm.js";import{Q as K}from"./QPage-DebNdnNk.js";import{f as U}from"./formatter-Cde3UNlN.js";import{a as Y}from"./user-XVlqxc0O.js";import{u as z}from"./application-K2-clfta.js";import"./position-engine-uhbLS0qU.js";import"./selection-BZqW8utQ.js";import"./dayjs.min-BtPkePTV.js";const tt={key:0,class:"row justify-center q-pa-xl"},et={key:1},st={class:"row q-col-gutter-md q-mb-lg"},ot={class:"col-12 col-sm-6 col-md-3"},at={class:"text-h4 text-bold text-primary"},lt={class:"col-12 col-sm-6 col-md-3"},rt={class:"text-h4 text-bold text-green"},nt={class:"col-12 col-sm-6 col-md-3"},it={class:"text-h4 text-bold text-orange"},dt={class:"col-12 col-sm-6 col-md-3"},ct={class:"text-h4 text-bold text-red"},ut={class:"row q-col-gutter-md"},mt={class:"col-12 col-md-8"},ft=["src"],vt={class:"text-caption q-mb-xs"},pt={key:0,class:"row q-gutter-xs"},gt={class:"col-12 col-md-4"},_t={key:0,class:"text-center text-grey"},xt={class:"row justify-between q-mb-xs"},bt={class:"text-bold"},yt={class:"text-grey"},Nt={__name:"AdminDashboardPage",setup(ht){const p=X(),B=T(),q=_(!0),u=_({totalVolunteers:0,totalHours:0,activeEvents:0,pendingApplications:0}),b=_([]),y=_([]),h=async()=>{try{const{data:l}=await Y();l.success&&(u.value=l.result.stats||u.value,b.value=l.result.recentApplications||[],y.value=l.result.popularSkills||[])}catch(l){console.error("Fetch dashboard failed",l),p.notify({color:"negative",message:"無法讀取儀表板數據"})}finally{q.value=!1}},$=l=>{l&&B.push({path:"/admin/events",query:{reviewEventId:l}})},E=l=>({approved:"green",rejected:"red",cancelled:"grey"})[l]||"grey",L=l=>({approved:"已錄取",rejected:"已拒絕",cancelled:"已取消"})[l]||l,N=async l=>{try{await z(l._id,{status:"approved"}),p.notify({type:"positive",message:"已錄取"}),h()}catch(e){console.error(e)}},I=l=>{p.dialog({title:"拒絕申請",message:"請輸入拒絕原因（此原因將會通知申請者）：",prompt:{model:"",type:"textarea",isValid:e=>e.length>0,placeholder:"例如：資格不符、名額已滿..."},cancel:!0,persistent:!0}).onOk(async e=>{try{await z(l._id,{status:"rejected",reviewComment:e}),p.notify({type:"positive",message:"已拒絕並發送通知"}),h()}catch(a){console.error(a)}})};return R(h),(l,e)=>(r(),f(K,{class:"q-pa-md"},{default:s(()=>[e[14]||(e[14]=o("div",{class:"text-h5 text-bold q-mb-md"},"管理後台",-1)),q.value?(r(),d("div",tt,[t(P,{color:"primary",size:"40px"})])):(r(),d("div",et,[o("div",st,[o("div",ot,[t(m,{flat:"",bordered:"",class:"full-height bg-blue-1"},{default:s(()=>[t(n,{class:"row items-center justify-between q-pb-none"},{default:s(()=>[e[0]||(e[0]=o("div",{class:"text-subtitle2 text-grey-8"},"總志工人數",-1)),t(v,{name:"group",color:"primary",size:"24px"})]),_:1}),t(n,null,{default:s(()=>[o("div",at,i(u.value.totalVolunteers),1),e[1]||(e[1]=o("div",{class:"text-caption text-grey-7"},"平台註冊會員總數",-1))]),_:1})]),_:1})]),o("div",lt,[t(m,{flat:"",bordered:"",class:"full-height bg-green-1"},{default:s(()=>[t(n,{class:"row items-center justify-between q-pb-none"},{default:s(()=>[e[2]||(e[2]=o("div",{class:"text-subtitle2 text-grey-8"},"累積服務時數",-1)),t(v,{name:"volunteer_activism",color:"green",size:"24px"})]),_:1}),t(n,null,{default:s(()=>[o("div",rt,i(u.value.totalHours),1),e[3]||(e[3]=o("div",{class:"text-caption text-grey-7"},"小時",-1))]),_:1})]),_:1})]),o("div",nt,[t(m,{flat:"",bordered:"",class:"full-height bg-orange-1"},{default:s(()=>[t(n,{class:"row items-center justify-between q-pb-none"},{default:s(()=>[e[4]||(e[4]=o("div",{class:"text-subtitle2 text-grey-8"},"進行中活動",-1)),t(v,{name:"event",color:"orange",size:"24px"})]),_:1}),t(n,null,{default:s(()=>[o("div",it,i(u.value.activeEvents),1),e[5]||(e[5]=o("div",{class:"text-caption text-grey-7"},"目前開放報名或進行中",-1))]),_:1})]),_:1})]),o("div",dt,[t(m,{flat:"",bordered:"",class:"full-height bg-red-1"},{default:s(()=>[t(n,{class:"row items-center justify-between q-pb-none"},{default:s(()=>[e[6]||(e[6]=o("div",{class:"text-subtitle2 text-grey-8"},"待審核申請",-1)),t(v,{name:"assignment_ind",color:"red",size:"24px"})]),_:1}),t(n,null,{default:s(()=>[o("div",ct,i(u.value.pendingApplications),1),e[7]||(e[7]=o("div",{class:"text-caption text-grey-7"},"需要立即處理",-1))]),_:1})]),_:1})])]),o("div",ut,[o("div",mt,[t(m,{flat:"",bordered:"",class:"full-height"},{default:s(()=>[t(n,{class:"row items-center"},{default:s(()=>[e[8]||(e[8]=o("div",{class:"text-h6"},"最新報名申請",-1)),t(W),t(w,{flat:"",color:"primary",label:"前往審核",to:"/admin/events","icon-right":"arrow_forward"})]),_:1}),t(S),t(G,{separator:""},{default:s(()=>[b.value.length===0?(r(),f(D,{key:0},{default:s(()=>[t(x,{class:"text-center text-grey q-pa-md"},{default:s(()=>[...e[9]||(e[9]=[c("目前無新申請",-1)])]),_:1})]),_:1})):C("",!0),(r(!0),d(j,null,A(b.value,a=>M((r(),f(D,{key:a._id,clickable:"",onClick:g=>$(a.event?._id)},{default:s(()=>[t(x,{avatar:""},{default:s(()=>[t(F,null,{default:s(()=>[o("img",{src:a.user?.avatar||`https://api.dicebear.com/9.x/thumbs/svg?seed=${a.user?.account}`},null,8,ft)]),_:2},1024)]),_:2},1024),t(x,null,{default:s(()=>[t(Q,{class:"text-bold"},{default:s(()=>[c(i(a.user?.name),1)]),_:2},1024),t(Q,{caption:""},{default:s(()=>[c("申請活動："+i(a.event?.title),1)]),_:2},1024),a.note?(r(),f(Q,{key:0,class:"text-blue-9 text-caption q-mt-xs bg-blue-1 q-pa-xs rounded-borders",style:{width:"fit-content"}},{default:s(()=>[t(v,{name:"sticky_note_2"}),c(" 備註："+i(a.note),1)]),_:2},1024)):C("",!0),t(k,null,{default:s(()=>[...e[10]||(e[10]=[c("點擊前往審核頁面",-1)])]),_:1})]),_:2},1024),t(x,{side:""},{default:s(()=>[o("div",vt,i(H(U)(a.createdAt)),1),a.status==="pending"?(r(),d("div",pt,[t(w,{flat:"",round:"",dense:"",color:"positive",icon:"check",onClick:V(g=>N(a),["stop"])},{default:s(()=>[t(k,null,{default:s(()=>[...e[11]||(e[11]=[c("快速錄取",-1)])]),_:1})]),_:1},8,["onClick"]),t(w,{flat:"",round:"",dense:"",color:"negative",icon:"close",onClick:V(g=>I(a),["stop"])},{default:s(()=>[t(k,null,{default:s(()=>[...e[12]||(e[12]=[c("拒絕",-1)])]),_:1})]),_:1},8,["onClick"])])):(r(),f(Z,{key:1,color:E(a.status),label:L(a.status)},null,8,["color","label"]))]),_:2},1024)]),_:2},1032,["onClick"])),[[O]])),128))]),_:1})]),_:1})]),o("div",gt,[t(m,{flat:"",bordered:"",class:"full-height"},{default:s(()=>[t(n,null,{default:s(()=>[...e[13]||(e[13]=[o("div",{class:"text-h6"},"熱門志工技能分佈",-1)])]),_:1}),t(S),t(n,{style:{"max-height":"300px","overflow-y":"auto"}},{default:s(()=>[y.value.length===0?(r(),d("div",_t,"尚無數據")):(r(!0),d(j,{key:1},A(y.value,(a,g)=>(r(),d("div",{key:g,class:"q-mb-md"},[o("div",xt,[o("span",bt,i(a.name),1),o("span",yt,i(a.count)+" 人",1)]),t(J,{value:a.percentage,color:"secondary",rounded:"",size:"8px"},null,8,["value"])]))),128))]),_:1})]),_:1})])])]))]),_:1}))}};export{Nt as default};
