import{c as A,ab as E,a as w,ac as M,h as T,X as R,ad as F,B as O,L as $,r as k,w as N,t as U,M as I,N as c,O as i,W as l,V as m,S as s,a9 as W,a1 as f,a0 as _,$ as S,a2 as V,a7 as H,_ as g,Z as q,a5 as G,T as X,U as Z}from"./index-D6DKEz1o.js";import{Q as J}from"./QSelect-UEYt4P4l.js";import{Q as K}from"./QSpace-BzUJ18PN.js";import{Q as L}from"./QTooltip-C_xb_D0P.js";import{Q as Y}from"./QBtnGroup-C-Se-qis.js";import{Q as ee}from"./QSpinnerDots-8pXkuwk1.js";import{Q as te}from"./QImg-kPaKReaU.js";import{u as ae,a as oe,b as P}from"./use-quasar-B_lJ7yIQ.js";import{Q as D}from"./QBadge-DZhUzhq6.js";import{Q as se}from"./QChip-Bt-jIDad.js";import{Q as le}from"./QPage-DebNdnNk.js";import{g as re}from"./event-Ca2ItUoJ.js";import{f as ne}from"./formatter-Cde3UNlN.js";import{g as ie,a as ce,b as de}from"./tag-colors-BBxGMC29.js";import{E as ue}from"./EventCard-EQff0M2M.js";import{_ as me}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QMenu-6AtEJnSj.js";import"./position-engine-uhbLS0qU.js";import"./selection-BZqW8utQ.js";import"./rtl-DFPa-2ov.js";import"./format-DyQxkAtJ.js";import"./dayjs.min-BtPkePTV.js";import"./useMatchScore-Dk32nqBb.js";const pe=A({name:"QBtnToggle",props:{...E,modelValue:{required:!0},options:{type:Array,required:!0,validator:o=>o.every(p=>("label"in p||"icon"in p||"slot"in p)&&"value"in p)},color:String,textColor:String,toggleColor:{type:String,default:"primary"},toggleTextColor:String,outline:Boolean,flat:Boolean,unelevated:Boolean,rounded:Boolean,push:Boolean,glossy:Boolean,size:String,padding:String,noCaps:Boolean,noWrap:Boolean,dense:Boolean,readonly:Boolean,disable:Boolean,stack:Boolean,stretch:Boolean,spread:Boolean,clearable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","clear","click"],setup(o,{slots:p,emit:v}){const z=w(()=>o.options.find(a=>a.value===o.modelValue)!==void 0),B=w(()=>({type:"hidden",name:o.name,value:o.modelValue})),h=F(B),y=w(()=>M(o)),x=w(()=>({rounded:o.rounded,dense:o.dense,...y.value})),Q=w(()=>o.options.map((a,t)=>{const{attrs:e,value:n,slot:r,...u}=a;return{slot:r,props:{key:t,"aria-pressed":n===o.modelValue?"true":"false",...e,...u,...x.value,disable:o.disable===!0||u.disable===!0,color:n===o.modelValue?d(u,"toggleColor"):d(u,"color"),textColor:n===o.modelValue?d(u,"toggleTextColor"):d(u,"textColor"),noCaps:d(u,"noCaps")===!0,noWrap:d(u,"noWrap")===!0,size:d(u,"size"),padding:d(u,"padding"),ripple:d(u,"ripple"),stack:d(u,"stack")===!0,stretch:d(u,"stretch")===!0,onClick(j){C(n,a,j)}}}}));function C(a,t,e){o.readonly!==!0&&(o.modelValue===a?o.clearable===!0&&(v("update:modelValue",null,null),v("clear")):v("update:modelValue",a,t),v("click",e))}function d(a,t){return a[t]===void 0?o[t]:a[t]}function b(){const a=Q.value.map(t=>T(R,t.props,t.slot!==void 0?p[t.slot]:void 0));return o.name!==void 0&&o.disable!==!0&&z.value===!0&&h(a,"push"),O(p.default,a)}return()=>T(Y,{class:"q-btn-toggle",...y.value,rounded:o.rounded,stretch:o.stretch,glossy:o.glossy,spread:o.spread},b)}}),ge={class:"row q-col-gutter-sm q-mb-md items-center"},ve={class:"col-12 col-md-4"},_e={class:"col-6 col-md-3"},fe={class:"col-auto gt-sm"},he={key:0,class:"flex flex-center q-pa-xl"},ye={key:1,class:"text-center text-grey q-pa-xl"},xe={key:2,class:"row q-col-gutter-lg"},Ce={key:3},we={class:"row q-col-gutter-md"},be={class:"row items-center full-width"},ke={class:"col-grow col-sm-3 q-pr-md"},qe={class:"text-h6 text-weight-bold q-mb-xs"},ze={class:"row items-center q-gutter-sm text-caption text-grey-8"},Be={class:"row items-center"},Qe={class:"row items-center"},Se={class:"col-sm-3 gt-xs row items-center justify-center q-gutter-x-sm"},Ve={class:"col-sm-3 gt-xs row items-center justify-center q-gutter-xs"},De={key:0,class:"text-grey-6 text-caption"},Te={class:"col-auto col-sm-3 column items-end justify-center q-gutter-y-sm"},Ie={key:0},Le={key:1,class:"text-grey-5 text-caption"},Pe={class:"text-caption"},je={class:"text-grey-7 q-ml-xs"},Ae={__name:"EventListPage",setup(o){const p=ae(),v=$(),z=k([]),B=k(!0),h=k(""),y=k("date_asc"),x=k("grid"),Q=[{label:"時間 (近 -> 遠)",value:"date_asc"},{label:"時間 (遠 -> 近)",value:"date_desc"},{label:"媒合分數 (高 -> 低)",value:"match_score_desc"},{label:"報名狀態 (可報名優先)",value:"status_asc"},{label:"活動類型",value:"category_asc"},{label:"志工類型",value:"volunteer_type_asc"},{label:"依技能",value:"skills_asc"}],C=a=>{if(!v.isLoggedIn)return 0;if(!a.requiredSkills?.length)return 100;const t=(v.user.skills||[]).map(r=>typeof r=="object"?r.name:String(r)),e=a.requiredSkills.map(r=>typeof r=="object"?r.name:String(r)),n=e.filter(r=>t.includes(r));return Math.round(n.length/e.length*100)},d=async()=>{try{const{data:a}=await re();z.value=a.result}catch(a){console.log(a),p.notify({type:"negative",message:"無法載入活動列表"})}finally{B.value=!1}},b=w(()=>{let a=[...z.value];if(h.value){const t=h.value.toLowerCase();a=a.filter(e=>e.title?.toLowerCase().includes(t)||e.location?.toLowerCase().includes(t))}return a.sort((t,e)=>{switch(y.value){case"date_asc":return new Date(t.serviceDateRange?.start)-new Date(e.serviceDateRange?.start);case"date_desc":return new Date(e.serviceDateRange?.start)-new Date(t.serviceDateRange?.start);case"match_score_desc":return C(e)-C(t);case"status_asc":{const n=t.approvedCount>=t.maxParticipants,r=e.approvedCount>=e.maxParticipants;return n===r?new Date(t.serviceDateRange?.start)-new Date(e.serviceDateRange?.start):n-r}case"category_asc":return(t.category?.name||"zzz").localeCompare(e.category?.name||"zzz","zh-Hant");case"volunteer_type_asc":return(t.volunteerType?.name||"zzz").localeCompare(e.volunteerType?.name||"zzz","zh-Hant");case"skills_asc":{const n=t.requiredSkills?.[0]?.name||"zzz",r=e.requiredSkills?.[0]?.name||"zzz";return n.localeCompare(r,"zh-Hant")}default:return 0}}),a});return N(()=>!p.screen.gt.sm,a=>{a&&(x.value="grid")},{immediate:!0}),U(d),(a,t)=>(c(),I(le,{class:"q-pa-md",style:{"padding-bottom":"80px"}},{default:i(()=>[l("div",ge,[l("div",ve,[s(W,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=e=>h.value=e),dense:"",outlined:"",placeholder:"搜尋活動名稱或地點...",clearable:"","bg-color":"white"},{prepend:i(()=>[s(f,{name:"search"})]),_:1},8,["modelValue"])]),l("div",_e,[s(J,{modelValue:y.value,"onUpdate:modelValue":t[1]||(t[1]=e=>y.value=e),options:Q,dense:"",outlined:"","emit-value":"","map-options":"",label:"排序方式","bg-color":"white"},{prepend:i(()=>[s(f,{name:"sort"})]),_:1},8,["modelValue"])]),s(K),l("div",fe,[s(pe,{modelValue:x.value,"onUpdate:modelValue":t[2]||(t[2]=e=>x.value=e),unelevated:"","toggle-color":"primary",options:[{value:"grid",slot:"grid"},{value:"list",slot:"list"}]},{grid:i(()=>[s(f,{name:"grid_view"}),s(L,null,{default:i(()=>[...t[3]||(t[3]=[_("卡片檢視",-1)])]),_:1})]),list:i(()=>[s(f,{name:"view_list"}),s(L,null,{default:i(()=>[...t[4]||(t[4]=[_("清單檢視",-1)])]),_:1})]),_:1},8,["modelValue"])])]),B.value?(c(),m("div",he,[s(ee,{color:"primary",size:"40px"})])):b.value.length===0?(c(),m("div",ye,[s(f,{name:"event_busy",size:"60px"}),t[5]||(t[5]=l("div",{class:"text-h6 q-mt-md"},"沒有符合條件的活動",-1))])):x.value==="grid"?(c(),m("div",xe,[(c(!0),m(S,null,V(b.value,e=>(c(),m("div",{key:e._id,class:"col-12 col-sm-6 col-md-4 col-lg-3"},[s(ue,{event:e},null,8,["event"])]))),128))])):(c(),m("div",Ce,[l("div",we,[(c(!0),m(S,null,V(b.value,e=>(c(),m("div",{key:e._id,class:"col-12"},[s(H,{flat:"",bordered:"",class:"cursor-pointer hover-card",onClick:n=>a.$router.push(`/events/${e._id}`)},{default:i(()=>[s(oe,{class:"q-py-md"},{default:i(()=>[s(P,{avatar:""},{default:i(()=>[s(te,{src:e.imgUrl||`https://picsum.photos/seed/${e._id}/400/300`,style:{width:"120px",height:"90px","border-radius":"8px"},fit:"cover"},null,8,["src"])]),_:2},1024),s(P,null,{default:i(()=>[l("div",be,[l("div",ke,[l("div",qe,g(e.title),1),l("div",ze,[l("div",Be,[s(f,{name:"event",size:"xs",class:"q-mr-xs"}),_(" "+g(q(ne)(e.serviceDateRange?.start)),1)]),s(G,{vertical:"",spaced:""}),l("div",Qe,[s(f,{name:"place",size:"xs",class:"q-mr-xs"}),_(" "+g(e.location),1)])])]),l("div",Se,[s(D,{color:q(ie)(e.category?.name)},{default:i(()=>[_(g(e.category?.name||"未分類"),1)]),_:2},1032,["color"]),s(D,{color:q(ce)(e.volunteerType?.name)},{default:i(()=>[_(g(e.volunteerType?.name||"一般志工"),1)]),_:2},1032,["color"])]),l("div",Ve,[(c(!0),m(S,null,V(e.requiredSkills,n=>(c(),I(se,{key:n._id,size:"sm",color:"blue-1","text-color":"blue-8",class:"q-ma-none"},{default:i(()=>[_(g(n.name),1)]),_:2},1024))),128)),e.requiredSkills?.length?X("",!0):(c(),m("span",De,"不限技能"))]),l("div",Te,[q(v).isLoggedIn?(c(),m("div",Ie,[s(D,{color:q(de)(C(e)),class:"q-pa-xs"},{default:i(()=>[_(" 契合度 "+g(C(e))+"% ",1)]),_:2},1032,["color"])])):(c(),m("div",Le,"請登入查看契合度")),l("div",Pe,[l("span",{class:Z(e.approvedCount>=e.maxParticipants?"text-negative text-bold":"text-primary")},g(e.approvedCount>=e.maxParticipants?"已額滿":"報名中"),3),l("span",je," ("+g(e.approvedCount)+" / "+g(e.maxParticipants)+") ",1)])])])]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"])]))),128))])]))]),_:1}))}},nt=me(Ae,[["__scopeId","data-v-939b2ed1"]]);export{nt as default};
