import{r as u,a as m,t as A,M as V,N as n,O as r,W as a,S as t,V as i,a9 as k,a1 as v,a5 as y,$ as S,a2 as z,a7 as B,a4 as I,a0 as f,_ as d,Z as M}from"./index-er4aaVKx.js";import{Q as R}from"./QSelect-M4jp-eYS.js";import{Q as C}from"./QSpinnerDots-BECCWhAB.js";import{u as L,a as N,b as _,Q as w}from"./use-quasar-CVMtQzkW.js";import{Q as Y}from"./QPage-B9KTMEwa.js";import{a as T}from"./application-e93rQymf.js";import{f as U}from"./formatter-Cde3UNlN.js";import"./QChip-Dkstk-14.js";import"./QMenu-Dcwm6_y8.js";import"./position-engine-dudcqdc6.js";import"./selection-BSJNt1Cs.js";import"./rtl-DFPa-2ov.js";import"./format-DyQxkAtJ.js";import"./dayjs.min-BtPkePTV.js";const $={class:"q-pa-md col-grow"},j={class:"row q-col-gutter-sm q-mb-md items-center"},F={class:"col-12 col-sm-6 col-md-4"},H={class:"col-12 col-sm-6 col-md-3"},O={key:0,class:"text-center q-pa-xl"},P={key:1,class:"text-center q-pa-xl text-grey"},E={key:2,class:"q-mb-xl"},W={class:"row q-col-gutter-md"},Z=["src"],G={class:"text-primary text-bold text-h6",style:{"white-space":"nowrap"}},J={class:"bg-white text-dark q-px-md q-py-sm"},K={class:"row justify-between items-center container",style:{"max-width":"1200px",margin:"0 auto"}},X={class:"text-h6 text-bold text-primary"},fe={__name:"ServiceHistoryPage",setup(ee){const D=L(),x=u([]),h=u(!0),c=u(""),l=u("dateDesc"),b=[{label:"日期 (新 -> 舊)",value:"dateDesc"},{label:"日期 (舊 -> 新)",value:"dateAsc"},{label:"時數 (多 -> 少)",value:"hoursDesc"},{label:"時數 (少 -> 多)",value:"hoursAsc"}],g=m(()=>x.value.filter(o=>o.status==="approved"&&o.attended)),Q=m(()=>{if(!c.value)return g.value;const o=c.value.toLowerCase();return g.value.filter(e=>e.event?.title?.toLowerCase().includes(o))}),p=m(()=>[...Q.value].sort((e,s)=>l.value==="dateDesc"?new Date(s.event.serviceDateRange.start)-new Date(e.event.serviceDateRange.start):l.value==="dateAsc"?new Date(e.event.serviceDateRange.start)-new Date(s.event.serviceDateRange.start):l.value==="hoursDesc"?s.event.hours-e.event.hours:l.value==="hoursAsc"?e.event.hours-s.event.hours:0)),q=m(()=>p.value.reduce((o,e)=>o+(e.event?.hours||0),0).toFixed(1));return A(async()=>{try{const{data:o}=await T();x.value=o.result||[]}catch(o){console.error(o),D.notify({color:"negative",message:"讀取服務歷程失敗"})}finally{h.value=!1}}),(o,e)=>(n(),V(Y,{class:"column"},{default:r(()=>[a("div",$,[e[4]||(e[4]=a("div",{class:"text-h5 text-bold q-mb-md"},"服務歷程",-1)),a("div",j,[a("div",F,[t(k,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=s=>c.value=s),dense:"",outlined:"",placeholder:"搜尋活動名稱...",clearable:"","prepend-icon":"search"},{prepend:r(()=>[t(v,{name:"search"})]),_:1},8,["modelValue"])]),a("div",H,[t(R,{modelValue:l.value,"onUpdate:modelValue":e[1]||(e[1]=s=>l.value=s),options:b,dense:"",outlined:"","emit-value":"","map-options":"",label:"排序方式"},null,8,["modelValue"])])]),t(y,{class:"q-mb-md"}),h.value?(n(),i("div",O,[t(C,{color:"primary",size:"40px"})])):p.value.length===0?(n(),i("div",P,[t(v,{name:"history_edu",size:"60px"}),e[2]||(e[2]=a("div",{class:"text-h6 q-mt-md"},"尚無符合條件的服務紀錄",-1))])):(n(),i("div",E,[a("div",W,[(n(!0),i(S,null,z(p.value,s=>(n(),i("div",{key:s._id,class:"col-12"},[t(B,{flat:"",bordered:"",class:"shadow-1"},{default:r(()=>[t(N,null,{default:r(()=>[t(_,{avatar:""},{default:r(()=>[t(I,{rounded:"",size:"80px"},{default:r(()=>[a("img",{src:s.event?.imgUrl||`https://picsum.photos/seed/${s.event?._id}/800/600`,style:{"object-fit":"cover"}},null,8,Z)]),_:2},1024)]),_:2},1024),t(_,null,{default:r(()=>[t(w,{class:"text-bold text-h6"},{default:r(()=>[f(d(s.event?.title),1)]),_:2},1024),t(w,{caption:""},{default:r(()=>[t(v,{name:"event",size:"xs"}),f(" "+d(M(U)(s.event?.serviceDateRange?.start,"YYYY-MM-DD"))+" ",1),e[3]||(e[3]=a("span",{class:"q-mx-xs"},"|",-1)),t(v,{name:"place",size:"xs"}),f(" "+d(s.event?.location),1)]),_:2},1024)]),_:2},1024),t(_,{side:""},{default:r(()=>[a("div",G," + "+d(s.event?.hours)+" 小時 ",1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]))),128))])]))]),t(y,{class:"q-mt-lg"}),a("div",J,[a("div",K,[e[5]||(e[5]=a("div",{class:"text-subtitle1"},"目前時數總計",-1)),a("div",X,d(q.value)+" 小時",1)])])]),_:1}))}};export{fe as default};
