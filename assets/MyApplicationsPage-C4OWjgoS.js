import{Q as L,a as g}from"./QTabs-DsozJY-w.js";import{L as U,r as _,Q as $,w as N,t as O,M as d,N as n,O as o,W as u,S as t,V as l,Y as q,U as E,a4 as w,_ as C,a1 as A,a0 as V,Z as m,a6 as F,a3 as R,T as f,$ as v,aq as T,X as S}from"./index-CDzfjR1d.js";import{Q as W}from"./QSpinnerDots-DupLQtYO.js";import{u as X,a as Y,b as y,Q as x}from"./use-quasar-CoSzPzcs.js";import{Q as j}from"./QBadge-BHrrKz5O.js";import{Q as Z,a as G}from"./QTabPanels-Cm6Ol-27.js";import{Q as H}from"./QPage-f92wfBlk.js";import{a as J,c as K}from"./application-_UpZYaPi.js";import{d as B}from"./dayjs.min-BtPkePTV.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QResizeObserver-Ce1VDxPF.js";import"./rtl-DFPa-2ov.js";import"./use-panel-D7X0vCDm.js";import"./touch-BjYP5sR0.js";import"./selection-Bvitp7Xf.js";import"./use-render-cache-DLxPkVnQ.js";const te={key:0,class:"text-center q-pa-xl"},ae={key:0,class:"text-center q-pa-xl text-grey"},se={class:"text-h6 q-mt-md"},oe={key:1,class:"row q-col-gutter-md"},re=["src"],ne={class:"row items-center q-gutter-x-sm"},le={class:"column items-end q-gutter-y-xs"},ie={key:0,class:"text-caption text-grey"},ce={__name:"MyApplicationsPage",setup(de){const i=X(),P=U(),Q=$(),p=_([]),h=_(!0),c=_(Q.query.tab||"pending");N(()=>Q.query.tab,e=>{e&&(c.value=e)});const b=e=>e==="pending"?p.value.filter(a=>a.status==="pending"):e==="approved"?p.value.filter(a=>a.status==="approved"):e==="closed"?p.value.filter(a=>a.status==="rejected"||a.status==="cancelled"):[],D=e=>({pending:"審核中",approved:"已錄取",rejected:"未錄取",cancelled:"已取消"})[e]||"未知狀態",I=e=>({pending:"orange",approved:"positive",rejected:"negative",cancelled:"grey-7"})[e]||"grey",M=e=>{if(!e||!e.event)return!1;const a=["pending","approved"].includes(e.status),r=B().isAfter(B(e.event.serviceDateRange?.end));return a&&!r&&!e.attended},k=async()=>{try{const{data:e}=await J();p.value=e.result}catch(e){console.error(e),i.notify({color:"negative",message:"讀取紀錄失敗"})}finally{h.value=!1}},z=e=>{i.dialog({title:"取消報名確認",message:"確定要取消此活動的報名嗎？此紀錄將移動至「未錄取/取消」清單。",cancel:{label:"返回",flat:!0,color:"grey"},ok:{label:"確定取消",flat:!0,color:"negative"},persistent:!0}).onOk(async()=>{try{await K(e),i.notify({color:"positive",message:"已成功取消報名",icon:"check"}),await k(),await P.fetchProfile()}catch(a){console.error(a),i.notify({color:"negative",message:"取消失敗"})}})};return O(k),(e,a)=>(n(),d(H,{class:"q-pa-md"},{default:o(()=>[a[2]||(a[2]=u("div",{class:"text-h5 text-bold q-mb-md"},"我的申請紀錄",-1)),t(L,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=r=>c.value=r),dense:"",class:E(["text-grey",{"no-wrap":q(i).screen.lt.md}]),"active-color":"primary","indicator-color":"primary",align:q(i).screen.gt.sm?"justify":"left","narrow-indicator":""},{default:o(()=>[t(g,{name:"pending",label:"進行中"}),t(g,{name:"approved",label:"已錄取"}),t(g,{name:"closed",label:"未錄取/取消"})]),_:1},8,["modelValue","class","align"]),t(w),h.value?(n(),l("div",te,[t(W,{color:"primary",size:"40px"})])):(n(),d(Z,{key:1,modelValue:c.value,"onUpdate:modelValue":a[1]||(a[1]=r=>c.value=r),animated:"",class:"bg-transparent q-mt-md"},{default:o(()=>[(n(),l(C,null,A(["pending","approved","closed"],r=>t(G,{key:r,name:r,class:"q-pa-none"},{default:o(()=>[b(r).length===0?(n(),l("div",ae,[t(V,{name:"history",size:"60px"}),u("div",se,m(r==="pending"?"目前沒有審核中的申請":r==="approved"?"目前沒有已錄取的活動":"沒有相關紀錄"),1)])):(n(),l("div",oe,[(n(!0),l(C,null,A(b(r),s=>(n(),l("div",{key:s._id,class:"col-12"},[t(F,{flat:"",bordered:"",class:"shadow-1"},{default:o(()=>[t(Y,null,{default:o(()=>[t(y,{avatar:""},{default:o(()=>[t(R,{rounded:"",size:"80px"},{default:o(()=>[u("img",{src:s.event?.imgUrl||`https://picsum.photos/seed/${s.event?._id}/800/600`,style:{"object-fit":"cover"}},null,8,re)]),_:2},1024)]),_:2},1024),t(y,null,{default:o(()=>[u("div",ne,[t(x,{class:"text-bold text-h6"},{default:o(()=>[v(m(s.event?.title),1)]),_:2},1024),s.attended?(n(),d(j,{key:0,color:"green",label:"已計入時數",icon:"done"})):f("",!0)]),t(x,{caption:"",class:"q-mt-xs"},{default:o(()=>[v(" 報名日期："+m(new Date(s.createdAt).toLocaleDateString()),1)]),_:2},1024),s.reviewComment?(n(),d(x,{key:0,class:"text-orange-9 text-caption q-mt-xs bg-orange-1 q-pa-xs rounded-borders"},{default:o(()=>[t(V,{name:"feedback"}),v(" 管理員回覆："+m(s.reviewComment),1)]),_:2},1024)):f("",!0)]),_:2},1024),t(y,{side:""},{default:o(()=>[u("div",le,[t(j,{color:I(s.status),class:"q-pa-sm text-subtitle2"},{default:o(()=>[v(m(D(s.status)),1)]),_:2},1032,["color"]),s.status==="approved"&&!s.attended?(n(),l("div",ie," 等待活動開展 ")):f("",!0)])]),_:2},1024)]),_:2},1024),t(w),t(T,{align:"right"},{default:o(()=>[t(S,{flat:"",color:"primary",icon:"info",label:"活動詳情",to:"/events/"+s.event?._id},null,8,["to"]),M(s)?(n(),d(S,{key:0,flat:"",color:"negative",icon:"cancel",label:"取消報名",onClick:ue=>z(s._id)},null,8,["onClick"])):f("",!0)]),_:2},1024)]),_:2},1024)]))),128))]))]),_:2},1032,["name"])),64))]),_:1},8,["modelValue"]))]),_:1}))}},Ve=ee(ce,[["__scopeId","data-v-02ba0f11"]]);export{Ve as default};
