import{r as n,Q as _,t as b,M as l,N as m,O as s,P as h,W as u,S as r,X as Q,a7 as k,a8 as f}from"./index-er4aaVKx.js";import{Q as x}from"./QSpinnerDots-BECCWhAB.js";import{Q as w}from"./QPage-B9KTMEwa.js";import{u as B}from"./use-quasar-CVMtQzkW.js";import{_ as E}from"./EventForm-eV_mZnwq.js";import{a as S,d as C,u as D}from"./event-DKEaC1qz.js";import"./QChip-Dkstk-14.js";import"./format-DyQxkAtJ.js";import"./QImg-am5JkeVQ.js";import"./QTooltip-DZz_Ql6j.js";import"./position-engine-dudcqdc6.js";import"./selection-BSJNt1Cs.js";import"./use-render-cache-DLxPkVnQ.js";import"./QMenu-Dcwm6_y8.js";import"./TouchPan-DRiuVfa5.js";import"./touch-BjYP5sR0.js";import"./QSelect-M4jp-eYS.js";import"./rtl-DFPa-2ov.js";import"./QBtnGroup---uURwoe.js";import"./use-fullscreen-D6k1_vyN.js";import"./QForm-C-6GcgDw.js";import"./ClosePopup-D4WXeABj.js";import"./upload-C-hovzSB.js";const q={class:"row items-center justify-between q-mb-md"},te={__name:"AdminEventEditPage",setup(N){const v=_(),d=h(),t=B(),c=n({}),p=n(!0),a=n(!1),i=v.params.id;b(async()=>{try{const{data:e}=await S(i);c.value=e.result}catch(e){console.error("Failed to fetch event data",e),t.notify({type:"negative",message:"讀取活動資料失敗"})}finally{p.value=!1}});const y=async e=>{a.value=!0;try{await D(i,e),t.notify({type:"positive",message:"活動已成功更新！"}),d.push("/admin/events")}catch(o){console.error("Update event failed",o),t.notify({type:"negative",message:o.response?.data?.message||"更新失敗"})}finally{a.value=!1}},g=()=>{t.dialog({title:"刪除確認",message:"確定要刪除此活動嗎？此動作無法復原，且相關報名紀錄也可能受影響。",cancel:{label:"取消",flat:!0,color:"grey"},ok:{label:"確定刪除",flat:!0,color:"negative"},persistent:!0}).onOk(async()=>{a.value=!0;try{await C(i),t.notify({type:"positive",message:"活動已成功刪除"}),d.replace("/admin/events")}catch(e){console.error("Delete event failed",e),t.notify({type:"negative",message:e.response?.data?.message||"刪除失敗"})}finally{a.value=!1}})};return(e,o)=>(m(),l(w,{class:"q-pa-md"},{default:s(()=>[u("div",q,[o[0]||(o[0]=u("div",{class:"text-h5 text-bold"},"編輯活動",-1)),r(Q,{color:"negative",icon:"delete",label:"刪除活動",outline:"",onClick:g,disable:a.value},null,8,["disable"])]),r(k,{flat:"",bordered:""},{default:s(()=>[p.value?(m(),l(f,{key:0,class:"text-center"},{default:s(()=>[r(x,{color:"primary",size:"40px"})]),_:1})):(m(),l(f,{key:1},{default:s(()=>[r(E,{"is-edit-mode":"","initial-data":c.value,loading:a.value,onSubmit:y},null,8,["initial-data","loading"])]),_:1}))]),_:1})]),_:1}))}};export{te as default};
