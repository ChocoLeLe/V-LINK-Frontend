import{Q as S}from"./QSpace-sYV4bR_9.js";import{L as B,J as G,r as d,t as z,M as _,N as b,O as c,P as A,W as s,S as r,a7 as I,a8 as V,X as u,a4 as j,Z as m,T as M,a9 as p,ar as N,U as E}from"./index-Cp7Hh5hQ.js";import{Q as g}from"./QSelect-C6uRbRqK.js";import{Q as O}from"./QPage-Ch16uarb.js";import{g as F,u as R}from"./upload-2FOtVMwy.js";import{u as v}from"./user-Ag_OBRs_.js";import{u as $}from"./use-quasar-5-QsCPJE.js";import{_ as D}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./QChip-DQbU_5ZG.js";import"./QMenu-BEPb-hGt.js";import"./position-engine-CEaxuUMw.js";import"./selection-D8PgaJPh.js";import"./rtl-DFPa-2ov.js";import"./format-DyQxkAtJ.js";const J={class:"row q-col-gutter-md justify-center"},L={class:"col-12 col-md-8"},T={class:"col-12 q-mb-md"},W={class:"row items-center justify-center q-gutter-x-xl"},X=["src"],Z={class:"column q-gutter-sm"},H={class:"col-12 col-sm-6"},K={class:"col-12 col-sm-6"},Y={class:"col-12"},ee={class:"col-12 col-sm-6"},le={class:"col-12 col-sm-6"},oe={class:"col-12"},ae={class:"col-12"},te={__name:"ProfileEditPage",setup(se){const t=B(),k=A(),i=$(),e=G({name:"",phone:"",gender:"",ageGroup:"",skills:[],bio:"",email:""}),y=d([]),f=d(!1),n=d(!1),h=d(null),w=["15-22歲 青年","23-45歲 青壯年","46-64歲 中壯年","65歲以上 高齡/銀髮"],x=()=>{t.user&&(e.name=t.user.name||"",e.phone=t.user.phone||"",e.gender=t.user.gender||"其他",e.ageGroup=t.user.ageGroup||"",e.bio=t.user.bio||"",e.email=t.user.email||"",e.skills=t.user.skills?t.user.skills.map(o=>typeof o=="object"?o.name:o):[])},Q=async()=>{try{const{data:o}=await F();y.value=o.result}catch(o){console.error("無法取得技能清單",o)}},q=()=>{h.value.click()},P=async o=>{const l=o.target.files[0];if(l){if(l.size>2*1024*1024){i.notify({color:"negative",message:"檔案大小不可超過 2MB",icon:"error"}),o.target.value="";return}n.value=!0;try{const{data:a}=await R(l);await v({avatar:a.result}),await t.fetchProfile(),i.notify({color:"positive",message:"頭像更新成功",icon:"check"})}catch(a){console.error(a),i.notify({color:"negative",message:"頭像上傳失敗"})}finally{n.value=!1,o.target.value=""}}},C=async()=>{i.dialog({title:"移除頭像",message:"確定要移除目前的頭像嗎？",cancel:!0,persistent:!0}).onOk(async()=>{n.value=!0;try{await v({avatar:""}),await t.fetchProfile(),i.notify({color:"positive",message:"頭像已移除",icon:"check"})}catch(o){console.error(o),i.notify({color:"negative",message:"移除失敗"})}finally{n.value=!1}})},U=async()=>{f.value=!0;try{await v(e),await t.fetchProfile(),i.notify({color:"positive",message:"個人檔案更新成功",icon:"check",timeout:1e3}),k.push("/my/profile")}catch(o){console.error("儲存失敗：",o),i.notify({color:"negative",message:"儲存失敗"})}finally{f.value=!1}};return z(async()=>{try{await t.fetchProfile(),await Q(),x()}catch(o){console.error("頁面初始化失敗:",o)}}),(o,l)=>(b(),_(O,{class:"q-pa-md"},{default:c(()=>[s("div",J,[s("div",L,[r(I,{flat:"",bordered:"",class:"q-pa-lg shadow-1"},{default:c(()=>[r(V,{class:"row items-center q-pb-none"},{default:c(()=>[l[7]||(l[7]=s("div",{class:"text-h6 text-bold"},"編輯個人資料",-1)),r(S),r(u,{flat:"",icon:"arrow_back",label:"返回個人檔案",to:"/my/profile",color:"grey-7"})]),_:1}),r(V,{class:"row q-col-gutter-md"},{default:c(()=>[s("div",T,[s("div",W,[r(j,{size:"120px",class:"shadow-2 border-primary"},{default:c(()=>[s("img",{src:m(t).user.avatar||`https://api.dicebear.com/9.x/thumbs/svg?seed=${m(t).user.account}`,style:{"object-fit":"cover",width:"100%",height:"100%"}},null,8,X)]),_:1}),s("div",Z,[r(u,{outline:"",color:"primary",icon:"upload_file",label:"更換頭像",onClick:q,size:"sm",loading:n.value},null,8,["loading"]),m(t).user.avatar?(b(),_(u,{key:0,outline:"",color:"negative",icon:"delete_forever",label:"移除頭像",onClick:C,size:"sm",loading:n.value},null,8,["loading"])):M("",!0),l[8]||(l[8]=s("div",{class:"text-caption text-grey q-mt-sm"},"檔案上限 2MB",-1))])]),s("input",{type:"file",ref_key:"fileInput",ref:h,style:{display:"none"},accept:"image/*",onChange:P},null,544)]),s("div",H,[r(p,{modelValue:e.name,"onUpdate:modelValue":l[0]||(l[0]=a=>e.name=a),label:"姓名",filled:"",dense:""},null,8,["modelValue"])]),s("div",K,[r(p,{modelValue:e.phone,"onUpdate:modelValue":l[1]||(l[1]=a=>e.phone=a),label:"聯絡電話",filled:"",dense:""},null,8,["modelValue"])]),s("div",Y,[r(p,{modelValue:e.email,"onUpdate:modelValue":l[2]||(l[2]=a=>e.email=a),label:"電子信箱",filled:"",dense:"",readonly:"",hint:"Email 註冊後不可更改"},null,8,["modelValue"])]),s("div",ee,[r(g,{modelValue:e.gender,"onUpdate:modelValue":l[3]||(l[3]=a=>e.gender=a),label:"性別",filled:"",dense:"",options:["男","女","其他"]},null,8,["modelValue"])]),s("div",le,[r(g,{modelValue:e.ageGroup,"onUpdate:modelValue":l[4]||(l[4]=a=>e.ageGroup=a),label:"年齡層",filled:"",dense:"",options:w},null,8,["modelValue"])]),s("div",oe,[r(g,{modelValue:e.skills,"onUpdate:modelValue":l[5]||(l[5]=a=>e.skills=a),label:"我的專長技能",multiple:"","use-chips":"",filled:"",dense:"",options:y.value,"option-label":"name","option-value":"name","emit-value":"","map-options":""},null,8,["modelValue","options"])]),s("div",ae,[r(p,{modelValue:e.bio,"onUpdate:modelValue":l[6]||(l[6]=a=>e.bio=a),label:"自我介紹",type:"textarea",filled:"",rows:"3",placeholder:"介紹一下你自己，讓媒合單位更了解你..."},null,8,["modelValue"])])]),_:1}),r(N,{align:"center"},{default:c(()=>[r(u,{color:"primary",label:"儲存並返回",loading:f.value,onClick:U,class:E(["text-bold",m(i).screen.lt.sm?"q-px-lg":"q-px-xl"])},null,8,["loading","class"])]),_:1})]),_:1})])])]),_:1}))}},be=D(te,[["__scopeId","data-v-4882f708"]]);export{be as default};
